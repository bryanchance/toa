[{"id":"b9aee244.570dc","type":"tab","label":"Lights","disabled":false,"info":""},{"id":"b6f275f1.f50b78","type":"tab","label":"CM3-Panel","disabled":false,"info":""},{"id":"9e2c603a.858fe","type":"tab","label":"CM3-Home","disabled":false,"info":""},{"id":"9a56a685.0b3558","type":"tab","label":"Assorbimenti","disabled":false,"info":""},{"id":"9baf0a1c.2eb568","type":"tab","label":"Telegram","disabled":false,"info":""},{"id":"7f63de28.637aa","type":"tab","label":"Sonoff","disabled":false,"info":""},{"id":"2bdcdf69.ad913","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"86a1cd35.744c2","type":"mqtt-broker","z":"","name":"toa","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"be48502d.a2f1f","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"4833e069.009da","type":"chatbot-telegram-node","z":"","botname":"Tanzo Office Automation","usernames":"","providerToken":"","polling":"1000","store":"","log":"","parseMode":"","debug":false},{"id":"619c3cbb.873b84","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"e0926b23.e33988","type":"mqtt out","z":"b6f275f1.f50b78","name":"","topic":"","qos":"","retain":"","broker":"86a1cd35.744c2","x":585,"y":290,"wires":[]},{"id":"7f774513.6aeffc","type":"inject","z":"b6f275f1.f50b78","name":"","topic":"toa/cm3panel","payload":"{\"cmd\":\"clock_off\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":195,"y":290,"wires":[["e0926b23.e33988"]]},{"id":"56f67e92.7fd16","type":"inject","z":"b6f275f1.f50b78","name":"","topic":"toa/cm3panel","payload":"{\"cmd\":\"clock_on\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":195,"y":350,"wires":[["e0926b23.e33988"]]},{"id":"72814bf.a675fb4","type":"inject","z":"b6f275f1.f50b78","name":"Golden bridge","topic":"toa/cm3panel","payload":"{\"cmd\":\"loadvideo\",\"value\":\"goldenbridge.mp4\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":265,"y":410,"wires":[["e0926b23.e33988"]]},{"id":"8e2433a3.7f622","type":"inject","z":"b6f275f1.f50b78","name":"Skyline","topic":"toa/cm3panel","payload":"{\"cmd\":\"loadvideo\",\"value\":\"skyline.mp4\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":285,"y":450,"wires":[["e0926b23.e33988"]]},{"id":"aff06c68.5058e","type":"inject","z":"b6f275f1.f50b78","name":"Singapore","topic":"toa/cm3panel","payload":"{\"cmd\":\"loadvideo\",\"value\":\"singapore.mp4\"}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"240","x":305,"y":490,"wires":[["e0926b23.e33988"]]},{"id":"5c7c9eea.0bb2a","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/6/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":555,"wires":[["c551a438.7caba8"]]},{"id":"e0e15875.0c8bd8","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/6/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":590,"wires":[["c551a438.7caba8"]]},{"id":"329c8ba5.fbf5d4","type":"http request","z":"b9aee244.570dc","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1445,"y":140,"wires":[[]]},{"id":"dede6718.ce4948","type":"mqtt in","z":"b9aee244.570dc","name":"","topic":"toa/lights/+/set_value","qos":"2","broker":"86a1cd35.744c2","x":980,"y":145,"wires":[["8f5f167.1a9f3e8"]]},{"id":"aa8c1c05.85dc7","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/16/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1420,"wires":[["ac9c39e6.ba5218"]]},{"id":"d0082c11.f6e27","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/16/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1455,"wires":[["ac9c39e6.ba5218"]]},{"id":"8c7724f5.b5fd28","type":"mqtt out","z":"b9aee244.570dc","name":"","topic":"","qos":"","retain":"false","broker":"86a1cd35.744c2","x":1400,"y":655,"wires":[]},{"id":"8f5f167.1a9f3e8","type":"function","z":"b9aee244.570dc","name":"Filtro relÃ¨","func":"var res = msg.topic.split(\"/\");\nvar msg1={};\n\nlight_id=parseInt(res[2]);\nlight_value=parseInt(msg.payload);\n\nif (light_id>=1 && light_id<=16) {\n\n\n    relay_id=light_id;\n    \n    if (light_value===0)\n        relay_value=0;\n    else    \n        relay_value=1;\n    \n    msg.url = \"http://192.168.1.8:80/current_state.json?pw=admin&Relay\" + relay_id + \"=\" + relay_value;\n\n\n    msg1.topic=\"toa/lights/\" + light_id + \"/current_value\";\n    msg1.payload=light_value;\n\n    return [msg,msg1];\n}  \n","outputs":2,"noerr":0,"x":1220,"y":145,"wires":[["329c8ba5.fbf5d4"],["bb296c75.6d0f6"]]},{"id":"2ab750f0.3c471","type":"exec","z":"9e2c603a.858fe","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":390,"y":145,"wires":[[],[],[]]},{"id":"8bce2dad.5ed52","type":"inject","z":"9e2c603a.858fe","name":"Halt","topic":"","payload":"sudo halt","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":145,"wires":[["2ab750f0.3c471"]]},{"id":"412bcf5d.0a197","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/7/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":345,"y":640,"wires":[["bb7ecf29.d8d38"]]},{"id":"62a6cae8.112ab4","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/7/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":345,"y":675,"wires":[["bb7ecf29.d8d38"]]},{"id":"eeaeff4c.10c08","type":"rpi-gpio in","z":"b9aee244.570dc","name":"WC uomini","pin":"24","intype":"tri","debounce":"25","read":false,"x":930,"y":635,"wires":[["2c5f2059.56eca"]]},{"id":"20759198.e3345e","type":"rpi-gpio in","z":"b9aee244.570dc","name":"WC donne","pin":"26","intype":"tri","debounce":"25","read":false,"x":930,"y":685,"wires":[["105a48c8.0920e7"]]},{"id":"2c5f2059.56eca","type":"function","z":"b9aee244.570dc","name":"","func":"var wc_uomini = flow.get('wc_uomini')||0;\n\nif (msg.payload===0) {\n    if (wc_uomini===0) {\n        msg.topic=\"toa/lights/6/set_value\";\n        msg.payload=1;\n        wc_uomini=1;\n        flow.set('wc_uomini',wc_uomini)\n    } else {\n        msg.topic=\"toa/lights/6/set_value\";\n        msg.payload=0;\n        wc_uomini=0;\n        flow.set('wc_uomini',wc_uomini)\n    }\n} else {\n    msg.payload=null;\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"x":1065,"y":635,"wires":[["cb309dcd.1bca4"]]},{"id":"105a48c8.0920e7","type":"function","z":"b9aee244.570dc","name":"","func":"var wc_donne = flow.get('wc_donne')||0;\n\nif (msg.payload===0) {\n    if (wc_donne===0) {\n        msg.topic=\"toa/lights/7/set_value\";\n        msg.payload=1;\n        wc_donne=1;\n        flow.set('wc_donne',wc_donne)\n    } else {\n        msg.topic=\"toa/lights/7/set_value\";\n        msg.payload=0;\n        wc_donne=0;\n        flow.set('wc_donne',wc_donne)\n    }\n} else {\n    msg.payload=null;\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"x":1065,"y":685,"wires":[["cb309dcd.1bca4"]]},{"id":"46f037b4.614358","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/VL1-FT","qos":"2","broker":"86a1cd35.744c2","x":185,"y":445,"wires":[[]]},{"id":"6950ad7d.a8f2c4","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/VL2-FT","qos":"2","broker":"86a1cd35.744c2","x":185,"y":495,"wires":[[]]},{"id":"4ca4343.39f4fcc","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/VL3-FT","qos":"2","broker":"86a1cd35.744c2","x":185,"y":545,"wires":[[]]},{"id":"fd6bc618.e21668","type":"comment","z":"9a56a685.0b3558","name":"Misuratore trifase Fotovoltaico","info":"","x":195,"y":405,"wires":[]},{"id":"73194d8d.03fff4","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/VL1-GEN","qos":"2","broker":"86a1cd35.744c2","x":185,"y":75,"wires":[[]]},{"id":"352894b7.3ffc7c","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/VL2-GEN","qos":"2","broker":"86a1cd35.744c2","x":185,"y":125,"wires":[[]]},{"id":"17c28da2.96cdc2","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/VL3-GEN","qos":"2","broker":"86a1cd35.744c2","x":185,"y":175,"wires":[[]]},{"id":"f2043e1c.57036","type":"comment","z":"9a56a685.0b3558","name":"Misuratore trifase QE Generale","info":"","x":205,"y":35,"wires":[]},{"id":"707fac7f.720174","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/KW1-GEN","qos":"2","broker":"86a1cd35.744c2","x":195,"y":230,"wires":[[]]},{"id":"aa37d9ce.edc8c8","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/KW2-GEN","qos":"2","broker":"86a1cd35.744c2","x":195,"y":280,"wires":[[]]},{"id":"f4758f7f.62fb7","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/KW3-GEN","qos":"2","broker":"86a1cd35.744c2","x":195,"y":330,"wires":[[]]},{"id":"93350d2e.d0e06","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/KWL1-FT","qos":"2","broker":"86a1cd35.744c2","x":185,"y":600,"wires":[[]]},{"id":"31e05043.e8306","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/KWL2-FT","qos":"2","broker":"86a1cd35.744c2","x":185,"y":650,"wires":[[]]},{"id":"74faef4f.9533","type":"mqtt in","z":"9a56a685.0b3558","name":"","topic":"toa/assorbimenti/KWL3-FT","qos":"2","broker":"86a1cd35.744c2","x":185,"y":700,"wires":[[]]},{"id":"15b926ab.916c79","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/3/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":355,"y":290,"wires":[["eae555d3.bde108"]]},{"id":"15c34850.5c9008","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/3/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":355,"y":325,"wires":[["eae555d3.bde108"]]},{"id":"a736cacf.3ab9f8","type":"comment","z":"b9aee244.570dc","name":"Stanza Verde (16)","info":"","x":170,"y":1420,"wires":[]},{"id":"40d8ee2b.63fe9","type":"comment","z":"b9aee244.570dc","name":"WC Uomini (6)","info":"","x":180,"y":555,"wires":[]},{"id":"6b45950d.f406bc","type":"comment","z":"b9aee244.570dc","name":"WC Donne (7)","info":"","x":175,"y":640,"wires":[]},{"id":"c4fd82f7.f3086","type":"comment","z":"b9aee244.570dc","name":"Scala (3)","info":"","x":195,"y":290,"wires":[]},{"id":"da1ecdf9.5c62d","type":"comment","z":"b9aee244.570dc","name":"Pulsanti","info":"","x":920,"y":595,"wires":[]},{"id":"c462e887.a78fe8","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/1/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":120,"wires":[["9a5e1d5f.99637"]]},{"id":"c44fbf85.1dc29","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/1/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":155,"wires":[["9a5e1d5f.99637"]]},{"id":"cb10a77a.877f98","type":"comment","z":"b9aee244.570dc","name":"Terrazzino (1)","info":"","x":180,"y":120,"wires":[]},{"id":"f992ed09.bc56b","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/2/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":355,"y":205,"wires":[["30a554b4.bc666c"]]},{"id":"8cf232e9.c8815","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/2/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":355,"y":240,"wires":[["30a554b4.bc666c"]]},{"id":"f4f79d38.92d5f","type":"comment","z":"b9aee244.570dc","name":"Terrazzone (2)","info":"","x":185,"y":205,"wires":[]},{"id":"f1879a7.cab5b68","type":"mqtt out","z":"9baf0a1c.2eb568","name":"","topic":"toa/cm3panel","qos":"","retain":"true","broker":"86a1cd35.744c2","x":960,"y":120,"wires":[]},{"id":"2b01c1fd.5d838e","type":"function","z":"9baf0a1c.2eb568","name":"Telegram2mqtt","func":"content=msg.payload[\"content\"];\nmsg.payload={\"cmd\":\"message\",\"value\":content}\nnode.status({text:content});\nreturn msg;","outputs":1,"noerr":0,"x":575,"y":120,"wires":[["f1879a7.cab5b68"]]},{"id":"2c0215df.d9600a","type":"chatbot-telegram-receive","z":"9baf0a1c.2eb568","bot":"4833e069.009da","botProduction":"","x":155,"y":85,"wires":[["2b01c1fd.5d838e","8e00a2e5.52358","3990720b.9d8b1e"]]},{"id":"8e00a2e5.52358","type":"chatbot-telegram-send","z":"9baf0a1c.2eb568","bot":"4833e069.009da","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":585,"y":165,"wires":[]},{"id":"3990720b.9d8b1e","type":"debug","z":"9baf0a1c.2eb568","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":565,"y":75,"wires":[]},{"id":"2454a37d.0c2bec","type":"inject","z":"7f63de28.637aa","name":"ON","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":95,"y":70,"wires":[["228b44ed.d86bac"]]},{"id":"a7c1866f.031518","type":"inject","z":"7f63de28.637aa","name":"OFF","topic":"","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":95,"y":110,"wires":[["228b44ed.d86bac"]]},{"id":"228b44ed.d86bac","type":"mqtt out","z":"7f63de28.637aa","name":"1273","topic":"cmnd/sonoff-1273/POWER","qos":"","retain":"","broker":"86a1cd35.744c2","x":265,"y":90,"wires":[]},{"id":"bb296c75.6d0f6","type":"mqtt out","z":"b9aee244.570dc","name":"","topic":"","qos":"","retain":"true","broker":"86a1cd35.744c2","x":1425,"y":195,"wires":[]},{"id":"92200da6.69dc8","type":"inject","z":"9baf0a1c.2eb568","name":"Welcome message","topic":"","payload":"Benvenuti in Acme Systems","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":365,"y":370,"wires":[["3faa6a18.17fb16"]]},{"id":"3faa6a18.17fb16","type":"function","z":"9baf0a1c.2eb568","name":"Text to JSON","func":"content=msg.payload;\nmsg.payload={\"cmd\":\"message\",\"value\":content}\nnode.status({text:content});\nreturn msg;","outputs":1,"noerr":0,"x":615,"y":370,"wires":[["f1879a7.cab5b68"]]},{"id":"cd4a8790.a21db8","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/10/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":910,"wires":[["4ffd9064.558b"]]},{"id":"82084543.9464d8","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/10/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":945,"wires":[["4ffd9064.558b"]]},{"id":"b94afbec.56f278","type":"comment","z":"b9aee244.570dc","name":"Sala (10)","info":"","x":190,"y":915,"wires":[]},{"id":"e56dd631.39e5a8","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/11/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":995,"wires":[["754a9ffd.9e21b"]]},{"id":"c64a4b3c.a5f218","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/11/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1030,"wires":[["754a9ffd.9e21b"]]},{"id":"d84b19f7.00df98","type":"comment","z":"b9aee244.570dc","name":"Cucina (11)","info":"","x":180,"y":995,"wires":[]},{"id":"5bd0ab84.b7c404","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/12/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1080,"wires":[["1cf2895b.f07237"]]},{"id":"62fa686e.f219d8","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/12/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1115,"wires":[["1cf2895b.f07237"]]},{"id":"c316cbf4.b51258","type":"comment","z":"b9aee244.570dc","name":"Open space (12)","info":"","x":170,"y":1085,"wires":[]},{"id":"c35bea2f.21d3f8","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/13/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1165,"wires":[["435de856.883668"]]},{"id":"5afe3e72.7f3d3","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/13/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1200,"wires":[["435de856.883668"]]},{"id":"7e15f3cf.e2c0ac","type":"comment","z":"b9aee244.570dc","name":"Gialla (13)","info":"","x":190,"y":1165,"wires":[]},{"id":"9e968d97.df504","type":"link in","z":"b9aee244.570dc","name":"mqtt_relay","links":["9a5e1d5f.99637","30a554b4.bc666c","eae555d3.bde108","c551a438.7caba8","bb7ecf29.d8d38","4ffd9064.558b","754a9ffd.9e21b","1cf2895b.f07237","435de856.883668","ac9c39e6.ba5218","cb309dcd.1bca4","5ff67e50.c8c93","1889247a.4dfd2c","3a1de492.400fac","fafa0ada.7aab98","a5c2793a.539ef8","8759dc81.87d51"],"x":1275,"y":655,"wires":[["8c7724f5.b5fd28"]]},{"id":"9a5e1d5f.99637","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":475,"y":135,"wires":[]},{"id":"30a554b4.bc666c","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":475,"y":220,"wires":[]},{"id":"eae555d3.bde108","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":305,"wires":[]},{"id":"c551a438.7caba8","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":565,"wires":[]},{"id":"bb7ecf29.d8d38","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":655,"wires":[]},{"id":"4ffd9064.558b","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":925,"wires":[]},{"id":"754a9ffd.9e21b","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":1010,"wires":[]},{"id":"1cf2895b.f07237","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":1095,"wires":[]},{"id":"435de856.883668","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":1180,"wires":[]},{"id":"ac9c39e6.ba5218","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":465,"y":1435,"wires":[]},{"id":"cb309dcd.1bca4","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":1170,"y":655,"wires":[]},{"id":"56fa72ed.6bfabc","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/4/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":375,"wires":[["5ff67e50.c8c93"]]},{"id":"474e0235.8aeedc","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/4/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":410,"wires":[["5ff67e50.c8c93"]]},{"id":"30ac1843.001488","type":"comment","z":"b9aee244.570dc","name":"(4)","info":"","x":200,"y":375,"wires":[]},{"id":"5ff67e50.c8c93","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":390,"wires":[]},{"id":"a4badd75.862f9","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/5/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":345,"y":460,"wires":[["1889247a.4dfd2c"]]},{"id":"9befa301.a8057","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/5/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":345,"y":495,"wires":[["1889247a.4dfd2c"]]},{"id":"bfd5d661.c759f8","type":"comment","z":"b9aee244.570dc","name":"(5)","info":"","x":195,"y":460,"wires":[]},{"id":"1889247a.4dfd2c","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":475,"wires":[]},{"id":"1e2b04f2.d1422b","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/8/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":345,"y":725,"wires":[["3a1de492.400fac"]]},{"id":"ff2aabf0.6bbba8","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/8/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":345,"y":760,"wires":[["3a1de492.400fac"]]},{"id":"8d8a60d9.89f46","type":"comment","z":"b9aee244.570dc","name":"(8)","info":"","x":190,"y":725,"wires":[]},{"id":"3a1de492.400fac","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":740,"wires":[]},{"id":"4eeae9f3.ab8208","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/9/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":815,"wires":[["fafa0ada.7aab98"]]},{"id":"4056086a.0228b8","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/9/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":850,"wires":[["fafa0ada.7aab98"]]},{"id":"d7969bb2.7d6428","type":"comment","z":"b9aee244.570dc","name":"(9)","info":"","x":195,"y":815,"wires":[]},{"id":"fafa0ada.7aab98","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":830,"wires":[]},{"id":"55eabb5e.93baa4","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/14/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":345,"y":1245,"wires":[["a5c2793a.539ef8"]]},{"id":"e0539c9.53d746","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/14/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":345,"y":1280,"wires":[["a5c2793a.539ef8"]]},{"id":"373becda.714b84","type":"comment","z":"b9aee244.570dc","name":"(14)","info":"","x":190,"y":1245,"wires":[]},{"id":"a5c2793a.539ef8","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":1260,"wires":[]},{"id":"63138de4.718f14","type":"inject","z":"b9aee244.570dc","name":"ON","topic":"toa/lights/15/set_value","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1335,"wires":[["8759dc81.87d51"]]},{"id":"7fe3ed72.e511c4","type":"inject","z":"b9aee244.570dc","name":"OFF","topic":"toa/lights/15/set_value","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":1370,"wires":[["8759dc81.87d51"]]},{"id":"b83dc549.e319a8","type":"comment","z":"b9aee244.570dc","name":"(15)","info":"","x":195,"y":1335,"wires":[]},{"id":"8759dc81.87d51","type":"link out","z":"b9aee244.570dc","name":"","links":["9e968d97.df504"],"x":470,"y":1350,"wires":[]},{"id":"e7a00ab5.b5dfe8","type":"inject","z":"b9aee244.570dc","name":"All ON","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1010,"y":415,"wires":[["abfef57c.099778"]]},{"id":"16b10ab2.c6c615","type":"inject","z":"b9aee244.570dc","name":"All OFF","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1010,"y":460,"wires":[["abfef57c.099778"]]},{"id":"953fe4.07f9902","type":"inject","z":"b9aee244.570dc","name":"Init","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":"1","x":1010,"y":365,"wires":[["abfef57c.099778"]]},{"id":"abfef57c.099778","type":"function","z":"b9aee244.570dc","name":"LightInit","func":"var light_state = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];\nvar outputMsgs = [];\n\nfor (i=0;i<light_state.length;i++) {\n    light_state[i]=msg.payload;\n}\n\nglobal.set('light_state',light_state);\n\nfor (i=0;i<light_state.length;i++) {\n    light_id=i+1;\n    outputMsgs.push({payload:light_state[i],topic:\"toa/lights/\" + light_id + \"/set_value\"});\n}\nreturn [outputMsgs];\n","outputs":1,"noerr":0,"x":1240,"y":365,"wires":[["a633cc1b.0a726"]]},{"id":"a633cc1b.0a726","type":"mqtt out","z":"b9aee244.570dc","name":"","topic":"","qos":"","retain":"","broker":"86a1cd35.744c2","x":1390,"y":365,"wires":[]},{"id":"2c69238e.09a6fc","type":"mqtt in","z":"b9aee244.570dc","name":"getval","topic":"toa/light/+/getval","qos":"2","broker":"86a1cd35.744c2","x":985,"y":850,"wires":[["3bb2f8d1.0b6f98"]]},{"id":"3bb2f8d1.0b6f98","type":"function","z":"b9aee244.570dc","name":"current_val","func":"light_state=global.get('light_state');\ntopic=msg.topic\nid=parseInt(topic.split(\"/\")[2]);\nmsg.payload=light_state[id];\nmsg.topic=\"toa/lights/\" + id + \"/current_val\";\n\nreturn msg;","outputs":1,"noerr":0,"x":1165,"y":850,"wires":[["a5e5b964.d6edf8"]]},{"id":"a5e5b964.d6edf8","type":"mqtt out","z":"b9aee244.570dc","name":"","topic":"","qos":"","retain":"true","broker":"86a1cd35.744c2","x":1305,"y":850,"wires":[]},{"id":"43f61970.e0c258","type":"inject","z":"b6f275f1.f50b78","name":"Restart Chromium","topic":"","payload":"sudo systemctl restart chromium","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":185,"wires":[["eb2cee49.922f8"]]},{"id":"eb2cee49.922f8","type":"mqtt out","z":"b6f275f1.f50b78","name":"","topic":"toa/cm3shell","qos":"","retain":"","broker":"86a1cd35.744c2","x":445,"y":170,"wires":[]},{"id":"23b25717.ae3698","type":"inject","z":"b6f275f1.f50b78","name":"Reboot","topic":"","payload":"sudo reboot","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":145,"wires":[["eb2cee49.922f8"]]},{"id":"11314bb4.4dfc04","type":"inject","z":"b6f275f1.f50b78","name":"Halt","topic":"","payload":"sudo halt","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":105,"wires":[["eb2cee49.922f8"]]}]